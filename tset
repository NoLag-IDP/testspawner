-- Escape Tsunami - Brainrot Spawner (Rayfield)
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- SCAN BRAINROTS
-- Path: ReplicatedStorage > Assets > Brainrots > [Rarity] > [Brainrot]
local brainrotLookup = {}
local brainrotNames  = {}

local function scanBrainrots()
	brainrotLookup = {}
	brainrotNames  = {}

	local assetsFolder = ReplicatedStorage:WaitForChild("Assets", 5)
	if not assetsFolder then
		warn("[Spawner] ReplicatedStorage.Assets not found!")
		return
	end

	local brainrotsFolder = assetsFolder:WaitForChild("Brainrots", 5)
	if not brainrotsFolder then
		warn("[Spawner] ReplicatedStorage.Assets.Brainrots not found!")
		return
	end

	for _, rarityFolder in ipairs(brainrotsFolder:GetChildren()) do
		if rarityFolder:IsA("Folder") then
			for _, brainrot in ipairs(rarityFolder:GetChildren()) do
				local name = brainrot.Name
				if not brainrotLookup[name] then
					brainrotLookup[name] = { rarity = rarityFolder.Name, object = brainrot }
					table.insert(brainrotNames, name)
					print("[Spawner] Found: " .. name .. " (" .. rarityFolder.Name .. ")")
				end
			end
		end
	end

	table.sort(brainrotNames)
	print("[Spawner] Total: " .. #brainrotNames .. " brainrots")
end

scanBrainrots()

-- Fallback if scan finds nothing
if #brainrotNames == 0 then
	warn("[Spawner] Using fallback list")
	brainrotNames = {
		"Tralalero Tralala",
		"Bombardiro Crocodilo",
		"Tung Tung Tung Sahur",
		"Brr Brr Patapim",
		"Cappuccino Assassino",
	}
	for _, n in ipairs(brainrotNames) do
		brainrotLookup[n] = { rarity = "Unknown", object = nil }
	end
end

-- SPAWN LOGIC
local function spawnBrainrot(name, level)
	if not name or name == "" then return false, "No brainrot selected!" end

	local lvl = tonumber(level)
	if not lvl or lvl < 1 then return false, "Level must be a number (min 1)!" end

	local entry = brainrotLookup[name]
	if not entry then return false, "Brainrot not found: " .. tostring(name) end

	local player = Players.LocalPlayer
	local character = player.Character
	if not character then return false, "Character not found!" end

	-- Clone the asset
	local cloned = nil
	if entry.object then
		pcall(function() entry.object.Archivable = true end)
		for _, v in ipairs(entry.object:GetDescendants()) do
			pcall(function() v.Archivable = true end)
		end
		local ok, result = pcall(function() return entry.object:Clone() end)
		if ok and result then
			cloned = result
		end
	end

	-- Fallback placeholder
	if not cloned then
		cloned = Instance.new("Tool")
		cloned.CanBeDropped = true
		cloned.RequiresHandle = false
		local part = Instance.new("Part")
		part.Name = "Handle"
		part.Size = Vector3.new(1, 1, 1)
		part.BrickColor = BrickColor.Random()
		part.Parent = cloned
	end

	cloned.Name = name
	cloned:SetAttribute("Level", lvl)
	cloned:SetAttribute("Rarity", entry.rarity)

	-- Convert to Tool if it isn't one already
	-- so Roblox knows how to hold it
	if not cloned:IsA("Tool") then
		local tool = Instance.new("Tool")
		tool.Name = name
		tool.CanBeDropped = true
		tool.RequiresHandle = false
		tool:SetAttribute("Level", lvl)
		tool:SetAttribute("Rarity", entry.rarity)

		-- Move all children into the Tool
		for _, child in ipairs(cloned:GetChildren()) do
			child.Parent = tool
		end

		-- Rename first BasePart to Handle so it equips properly
		local handle = tool:FindFirstChild("Handle")
		if not handle then
			local firstPart = tool:FindFirstChildWhichIsA("BasePart")
			if firstPart then
				firstPart.Name = "Handle"
			end
		end

		cloned:Destroy()
		cloned = tool
	else
		-- Already a Tool, just make sure Handle exists
		local handle = cloned:FindFirstChild("Handle")
		if not handle then
			local firstPart = cloned:FindFirstChildWhichIsA("BasePart")
			if firstPart then
				firstPart.Name = "Handle"
			end
		end
	end

	-- Step 1: put in backpack first so it registers
	local backpack = player:FindFirstChild("Backpack")
	if backpack then
		cloned.Parent = backpack
	else
		cloned.Parent = character
	end

	-- Step 2: equip it so it appears in hand immediately
	-- Use Humanoid:EquipTool if available
	task.wait(0.05)
	local humanoid = character:FindFirstChildOfClass("Humanoid")
	if humanoid then
		pcall(function()
			humanoid:EquipTool(cloned)
		end)
	end

	return true, name .. " (Lv." .. lvl .. ") [" .. entry.rarity .. "] is now in your hand!"
end

-- RAYFIELD WINDOW
local Window = Rayfield:CreateWindow({
	Name                   = "Brainrot Spawner",
	LoadingTitle           = "Escape Tsunami",
	LoadingSubtitle        = "Brainrot Spawner",
	Theme                  = "Default",
	DisableRayfieldPrompts = true,
	DisableBuildWarnings   = true,
	ConfigurationSaving    = { Enabled = false },
	KeySystem              = false,
})

local Tab = Window:CreateTab("Spawn", 0)

-- State
local selectedBrainrot = brainrotNames[1] or ""
local levelValue = "1"

-- Dropdown
Tab:CreateDropdown({
	Name            = "Select Brainrot  (" .. #brainrotNames .. " found)",
	Options         = brainrotNames,
	CurrentOption   = { brainrotNames[1] },
	MultipleOptions = false,
	Flag            = "BrainrotDropdown",
	Callback        = function(option)
		if type(option) == "table" then
			selectedBrainrot = option[1] or ""
		else
			selectedBrainrot = tostring(option)
		end
		local entry = brainrotLookup[selectedBrainrot]
		if entry then
			print("[Spawner] Selected: " .. selectedBrainrot .. " | Rarity: " .. entry.rarity)
		end
	end,
})

-- Level input
Tab:CreateInput({
	Name            = "Level",
	CurrentValue    = "1",
	PlaceholderText = "e.g. 50",
	NumbersOnly     = true,
	Flag            = "LevelInput",
	Callback        = function(val)
		levelValue = val
	end,
})

-- Spawn button
Tab:CreateButton({
	Name     = "Spawn Brainrot",
	Callback = function()
		if not selectedBrainrot or selectedBrainrot == "" then
			Rayfield:Notify({ Title = "No Brainrot", Content = "Pick a brainrot from the dropdown!", Duration = 4 })
			return
		end
		if levelValue == "" or not tonumber(levelValue) then
			Rayfield:Notify({ Title = "Invalid Level", Content = "Level must be a valid number!", Duration = 4 })
			return
		end
		local ok, msg = spawnBrainrot(selectedBrainrot, levelValue)
		if ok then
			Rayfield:Notify({ Title = "Spawned!", Content = msg, Duration = 4 })
		else
			Rayfield:Notify({ Title = "Error", Content = msg, Duration = 4 })
		end
	end,
})

-- Clear button
Tab:CreateButton({
	Name     = "Clear Spawned Brainrots",
	Callback = function()
		local player = Players.LocalPlayer
		local backpack = player:FindFirstChild("Backpack")
		local character = player.Character
		local count = 0

		-- Check backpack
		if backpack then
			for _, item in ipairs(backpack:GetChildren()) do
				if brainrotLookup[item.Name] then
					item:Destroy()
					count += 1
				end
			end
		end

		-- Check character (equipped)
		if character then
			for _, item in ipairs(character:GetChildren()) do
				if item:IsA("Tool") and brainrotLookup[item.Name] then
					item:Destroy()
					count += 1
				end
			end
		end

		Rayfield:Notify({ Title = "Cleared", Content = "Removed " .. count .. " brainrot(s)!", Duration = 4 })
	end,
})
